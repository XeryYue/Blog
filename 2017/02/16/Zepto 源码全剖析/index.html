<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="这是我第一次做源码剖析类的文章,既是对自己的代码素养的提高,也是希望能够为对 Zepto 源码剖析感兴趣的同学有所启发.">
<meta property="og:type" content="article">
<meta property="og:title" content="Zepto 源码全剖析">
<meta property="og:url" content="http://zhangxiang958.github.io/2017/02/16/Zepto 源码全剖析/index.html">
<meta property="og:site_name" content="Shawn&#39;s blog">
<meta property="og:description" content="这是我第一次做源码剖析类的文章,既是对自己的代码素养的提高,也是希望能够为对 Zepto 源码剖析感兴趣的同学有所启发.">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="1979-11-29T16:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zepto 源码全剖析">
<meta name="twitter:description" content="这是我第一次做源码剖析类的文章,既是对自己的代码素养的提高,也是希望能够为对 Zepto 源码剖析感兴趣的同学有所启发.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhangxiang958.github.io/2017/02/16/Zepto 源码全剖析/">





  <title>Zepto 源码全剖析 | Shawn's blog</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Shawn's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">大道至简, 悟在天成</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zhangxiang958.github.io/2017/02/16/Zepto 源码全剖析/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Shawn">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://img.ijarvis.cn/916161494.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shawn's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Zepto 源码全剖析</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-16T22:17:24+08:00">
                2017-02-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>这是我第一次做源码剖析类的文章,既是对自己的代码素养的提高,也是希望能够为对 Zepto 源码剖析感兴趣的同学有所<br>启发.<br><a id="more"></a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//     Zepto.js</span></span><br><span class="line"><span class="comment">//     (c) 2010-2016 Thomas Fuchs</span></span><br><span class="line"><span class="comment">//     Zepto.js may be freely distributed under the MIT license.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="literal">undefined</span>, </span><br><span class="line">    key, </span><br><span class="line">    $, </span><br><span class="line">    classList, </span><br><span class="line">    emptyArray = [], </span><br><span class="line">    concat = emptyArray.concat, </span><br><span class="line">    filter = emptyArray.filter, </span><br><span class="line">    slice = emptyArray.slice,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//save the window.document</span></span><br><span class="line">    <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">    elementDisplay = &#123;&#125;, classCache = &#123;&#125;,</span><br><span class="line">    cssNumber = &#123; </span><br><span class="line">      <span class="string">'column-count'</span>: <span class="number">1</span>, </span><br><span class="line">      <span class="string">'columns'</span>: <span class="number">1</span>, </span><br><span class="line">      <span class="string">'font-weight'</span>: <span class="number">1</span>, </span><br><span class="line">      <span class="string">'line-height'</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">'opacity'</span>: <span class="number">1</span>, </span><br><span class="line">      <span class="string">'z-index'</span>: <span class="number">1</span>, </span><br><span class="line">      <span class="string">'zoom'</span>: <span class="number">1</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    fragmentRE = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>,</span><br><span class="line">    singleTagRE = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,</span><br><span class="line">    tagExpanderRE = <span class="regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig</span>,</span><br><span class="line">    rootNodeRE = <span class="regexp">/^(?:body|html)$/i</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//大写字母</span></span><br><span class="line">    capitalRE = <span class="regexp">/([A-Z])/g</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// special attributes that should be get/set via method calls</span></span><br><span class="line">    methodAttributes = [<span class="string">'val'</span>, <span class="string">'css'</span>, <span class="string">'html'</span>, <span class="string">'text'</span>, <span class="string">'data'</span>, <span class="string">'width'</span>, <span class="string">'height'</span>, <span class="string">'offset'</span>],</span><br><span class="line"></span><br><span class="line">    <span class="comment">//DOM 连接位置</span></span><br><span class="line">    adjacencyOperators = [ <span class="string">'after'</span>, <span class="string">'prepend'</span>, <span class="string">'before'</span>, <span class="string">'append'</span> ],</span><br><span class="line">    table = <span class="built_in">document</span>.createElement(<span class="string">'table'</span>),</span><br><span class="line">    tableRow = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>),</span><br><span class="line">    containers = &#123;</span><br><span class="line">      <span class="string">'tr'</span>: <span class="built_in">document</span>.createElement(<span class="string">'tbody'</span>),</span><br><span class="line">      <span class="string">'tbody'</span>: table, </span><br><span class="line">      <span class="string">'thead'</span>: table, </span><br><span class="line">      <span class="string">'tfoot'</span>: table,</span><br><span class="line">      <span class="string">'td'</span>: tableRow, </span><br><span class="line">      <span class="string">'th'</span>: tableRow,</span><br><span class="line">      <span class="string">'*'</span>: <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    simpleSelectorRE = <span class="regexp">/^[\w-]*$/</span>,</span><br><span class="line">    </span><br><span class="line">    class2type = &#123;&#125;,</span><br><span class="line"></span><br><span class="line">    toString = class2type.toString,</span><br><span class="line">    </span><br><span class="line">    zepto = &#123;&#125;,</span><br><span class="line">    camelize, uniq,</span><br><span class="line">    <span class="comment">//临时的 div,用于 zepto.matches</span></span><br><span class="line">    tempParent = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>),</span><br><span class="line">    <span class="comment">//属性映射</span></span><br><span class="line">    propMap = &#123;</span><br><span class="line">      <span class="string">'tabindex'</span>: <span class="string">'tabIndex'</span>,</span><br><span class="line">      <span class="string">'readonly'</span>: <span class="string">'readOnly'</span>,</span><br><span class="line">      <span class="string">'for'</span>: <span class="string">'htmlFor'</span>,</span><br><span class="line">      <span class="string">'class'</span>: <span class="string">'className'</span>,</span><br><span class="line">      <span class="string">'maxlength'</span>: <span class="string">'maxLength'</span>,</span><br><span class="line">      <span class="string">'cellspacing'</span>: <span class="string">'cellSpacing'</span>,</span><br><span class="line">      <span class="string">'cellpadding'</span>: <span class="string">'cellPadding'</span>,</span><br><span class="line">      <span class="string">'rowspan'</span>: <span class="string">'rowSpan'</span>,</span><br><span class="line">      <span class="string">'colspan'</span>: <span class="string">'colSpan'</span>,</span><br><span class="line">      <span class="string">'usemap'</span>: <span class="string">'useMap'</span>,</span><br><span class="line">      <span class="string">'frameborder'</span>: <span class="string">'frameBorder'</span>,</span><br><span class="line">      <span class="string">'contenteditable'</span>: <span class="string">'contentEditable'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    isArray = <span class="built_in">Array</span>.isArray ||</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params">object</span>)</span>&#123; <span class="keyword">return</span> object <span class="keyword">instanceof</span> <span class="built_in">Array</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  zepto.matches = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//如果没有选择器,或者没有元素,或者节点不是元素类型,返回 false</span></span><br><span class="line">    <span class="keyword">if</span> (!selector || !element || element.nodeType !== <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Web API, element.matches, 兼容性写法</span></span><br><span class="line">    <span class="keyword">var</span> matchesSelector = element.matches || element.webkitMatchesSelector ||</span><br><span class="line">                          element.mozMatchesSelector || element.oMatchesSelector ||</span><br><span class="line">                          element.matchesSelector</span><br><span class="line">    <span class="keyword">if</span> (matchesSelector) <span class="keyword">return</span> matchesSelector.call(element, selector)</span><br><span class="line">    <span class="comment">// fall back to performing a selector:</span></span><br><span class="line">    <span class="keyword">var</span> match, parent = element.parentNode, temp = !parent</span><br><span class="line">    <span class="comment">//如果没有父元素, 就将父元素暂时存到临时变量 tempParent 中</span></span><br><span class="line">    <span class="keyword">if</span> (temp) (parent = tempParent).appendChild(element)</span><br><span class="line">    <span class="comment">//~ 按位取反 - 1 , 即 1 变成 -2 , 0 变成 -1,当 match 值为 -1 的时候,代表没有找到</span></span><br><span class="line">    match = ~zepto.qsa(parent, selector).indexOf(element)</span><br><span class="line">    temp &amp;&amp; tempParent.removeChild(element)</span><br><span class="line">    <span class="keyword">return</span> match</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断值的类型, 如果是对象的话, 使用 Object.prototype.toString.call(obj); 可以知道对象的类型</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//toString 转型函数</span></span><br><span class="line">    <span class="keyword">return</span> obj == <span class="literal">null</span> ? <span class="built_in">String</span>(obj) :</span><br><span class="line">      class2type[toString.call(obj)] || <span class="string">"object"</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断是不是函数类型</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">value</span>) </span>&#123; </span><br><span class="line">      <span class="keyword">return</span> type(value) == <span class="string">"function"</span> </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//判断是不是 window 对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>)     </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj == obj.window </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//判断是不是 document 对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isDocument</span>(<span class="params">obj</span>)   </span>&#123; </span><br><span class="line">      <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj.nodeType == obj.DOCUMENT_NODE </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//判断是不是对象类型</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>)     </span>&#123; <span class="keyword">return</span> type(obj) == <span class="string">"object"</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//是不是原生对象 Object</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isObject(obj) &amp;&amp; !isWindow(obj) &amp;&amp; <span class="built_in">Object</span>.getPrototypeOf(obj) == <span class="built_in">Object</span>.prototype</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断是否是类数组对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">likeArray</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> length = !!obj &amp;&amp; <span class="string">'length'</span> <span class="keyword">in</span> obj &amp;&amp; obj.length,</span><br><span class="line">      type = $.type(obj)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'function'</span> != type &amp;&amp; !isWindow(obj) &amp;&amp; (</span><br><span class="line">      <span class="string">'array'</span> == type || length === <span class="number">0</span> ||</span><br><span class="line">        (<span class="keyword">typeof</span> length == <span class="string">'number'</span> &amp;&amp; length &gt; <span class="number">0</span> &amp;&amp; (length - <span class="number">1</span>) <span class="keyword">in</span> obj)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">compact</span>(<span class="params">array</span>) </span>&#123; <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123; <span class="keyword">return</span> item != <span class="literal">null</span> &#125;) &#125;</span><br><span class="line">  <span class="comment">//扁平化数组</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">flatten</span>(<span class="params">array</span>) </span>&#123; <span class="keyword">return</span> array.length &gt; <span class="number">0</span> ? $.fn.concat.apply([], array) : array &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//将字符串转化为驼峰写法</span></span><br><span class="line">  camelize = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123; <span class="keyword">return</span> str.replace(<span class="regexp">/-+(.)?/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match, chr</span>)</span>&#123; <span class="keyword">return</span> chr ? chr.toUpperCase() : <span class="string">''</span> &#125;) &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//将字符串转化为连接符</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dasherize</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.replace(<span class="regexp">/::/g</span>, <span class="string">'/'</span>)</span><br><span class="line">           .replace(<span class="regexp">/([A-Z]+)([A-Z][a-z])/g</span>, <span class="string">'$1_$2'</span>)</span><br><span class="line">           .replace(<span class="regexp">/([a-z\d])([A-Z])/g</span>, <span class="string">'$1_$2'</span>)</span><br><span class="line">           .replace(<span class="regexp">/_/g</span>, <span class="string">'-'</span>)</span><br><span class="line">           .toLowerCase()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//检查数组中是不是有重复的元素, 将重复的元素去掉,返回一个数组</span></span><br><span class="line">  uniq = <span class="function"><span class="keyword">function</span>(<span class="params">array</span>)</span>&#123; <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span>(<span class="params">item, idx</span>)</span>&#123; <span class="keyword">return</span> array.indexOf(item) == idx &#125;) &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//新建匹配类名的正则表达式</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">classRE</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">in</span> classCache ?</span><br><span class="line">      classCache[name] : (classCache[name] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'(^|\\s)'</span> + name + <span class="string">'(\\s|$)'</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//为数值添加 px 后缀单位</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">maybeAddPx</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> value == <span class="string">"number"</span> &amp;&amp; !cssNumber[dasherize(name)]) ? value + <span class="string">"px"</span> : value</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//设置元素默认 display 样式</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">defaultDisplay</span>(<span class="params">nodeName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element, display</span><br><span class="line">    <span class="keyword">if</span> (!elementDisplay[nodeName]) &#123;</span><br><span class="line">      element = <span class="built_in">document</span>.createElement(nodeName)</span><br><span class="line">      <span class="built_in">document</span>.body.appendChild(element)</span><br><span class="line">      display = getComputedStyle(element, <span class="string">''</span>).getPropertyValue(<span class="string">"display"</span>)</span><br><span class="line">      element.parentNode.removeChild(element)</span><br><span class="line">      display == <span class="string">"none"</span> &amp;&amp; (display = <span class="string">"block"</span>)</span><br><span class="line">      elementDisplay[nodeName] = display</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> elementDisplay[nodeName]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取子元素</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">children</span>(<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'children'</span> <span class="keyword">in</span> element ?</span><br><span class="line">      <span class="comment">//节点的 children 属性返回节点的元素字节点集合</span></span><br><span class="line">      slice.call(element.children) :</span><br><span class="line">      <span class="comment">//如果没有 children, 那么就用 childNodes, 返回包含的元素节点就可以了(nodeType === 1)</span></span><br><span class="line">      $.map(element.childNodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123; <span class="keyword">if</span> (node.nodeType == <span class="number">1</span>) <span class="keyword">return</span> node &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Z</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//组建 Zepto 对象: </span></span><br><span class="line">    <span class="comment">//&#123;</span></span><br><span class="line">    <span class="comment">//   dom: []</span></span><br><span class="line">    <span class="comment">//   length: 0</span></span><br><span class="line">    <span class="comment">//   selector: ''</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="keyword">var</span> i, len = dom ? dom.length : <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) <span class="keyword">this</span>[i] = dom[i]</span><br><span class="line">    <span class="keyword">this</span>.length = len</span><br><span class="line">    <span class="keyword">this</span>.selector = selector || <span class="string">''</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.fragment` takes a html string and an optional tag name</span></span><br><span class="line">  <span class="comment">// to generate DOM nodes from the given html string.</span></span><br><span class="line">  <span class="comment">// The generated DOM nodes are returned as an array.</span></span><br><span class="line">  <span class="comment">// This function can be overridden in plugins for example to make</span></span><br><span class="line">  <span class="comment">// it compatible with browsers that don't support the DOM fully.</span></span><br><span class="line">  <span class="comment">//fragment 函数接收 html 字符串和一个 tag 名, 在 tag 的后代生成 html 标签,</span></span><br><span class="line">  <span class="comment">//返回的结果是以节点数组形式返回</span></span><br><span class="line">  <span class="comment">//核心方法</span></span><br><span class="line">  zepto.fragment = <span class="function"><span class="keyword">function</span>(<span class="params">html, name, properties</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom, nodes, container</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"html is "</span> + html);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"name is "</span> + name);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"properties is "</span> + properties);</span><br><span class="line">    <span class="comment">// A special case optimization for a single tag</span></span><br><span class="line">    <span class="comment">//RegExp.$[1-99] 是内置正则对象的属性,数字代表正则表达式匹配的第几个字符串</span></span><br><span class="line">    <span class="comment">//这里的正则对象是全局正则对象</span></span><br><span class="line">    <span class="keyword">if</span> (singleTagRE.test(html)) dom = $(<span class="built_in">document</span>.createElement(<span class="built_in">RegExp</span>.$<span class="number">1</span>))</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"RegExp.$1 is "</span> + <span class="built_in">RegExp</span>.$<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'dom is '</span> + dom);</span><br><span class="line">    <span class="built_in">console</span>.log(dom);</span><br><span class="line">    <span class="keyword">if</span> (!dom) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"no dom"</span>);</span><br><span class="line">      <span class="keyword">if</span> (html.replace) &#123;</span><br><span class="line">       html = html.replace(tagExpanderRE, <span class="string">"&lt;$1&gt;&lt;/$2&gt;"</span>)</span><br><span class="line">       <span class="built_in">console</span>.log(html); </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(name);</span><br><span class="line">      <span class="keyword">if</span> (name === <span class="literal">undefined</span>) name = fragmentRE.test(html) &amp;&amp; <span class="built_in">RegExp</span>.$<span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (!(name <span class="keyword">in</span> containers)) name = <span class="string">'*'</span></span><br><span class="line">      <span class="built_in">console</span>.log(name);</span><br><span class="line">      container = containers[name]</span><br><span class="line">      container.innerHTML = <span class="string">''</span> + html</span><br><span class="line">      dom = $.each(slice.call(container.childNodes), <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        container.removeChild(<span class="keyword">this</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(properties)) &#123;<span class="comment">//是否是原生对象,但是不是 window 对象(document.window)</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"isPlainObject(properties) is "</span> + isPlainObject(properties));</span><br><span class="line">      <span class="built_in">console</span>.log(dom);</span><br><span class="line">      nodes = $(dom);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">typeof</span> $(dom));</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">typeof</span> nodes);</span><br><span class="line">      <span class="comment">// console.log(nodes);</span></span><br><span class="line">      <span class="comment">// $.each = function(elements, callback)&#123;</span></span><br><span class="line">      <span class="comment">//   var i, key</span></span><br><span class="line">      <span class="comment">//   if (likeArray(elements)) &#123; //Object.toString.call(arg) 可以检验真正的对象类型</span></span><br><span class="line">      <span class="comment">//     如果是数组类型</span></span><br><span class="line">      <span class="comment">//     for (i = 0; i &lt; elements.length; i++)</span></span><br><span class="line">      <span class="comment">//       if (callback.call(elements[i], i, elements[i]) === false) return elements</span></span><br><span class="line">      <span class="comment">//     &#125; else &#123;</span></span><br><span class="line">      <span class="comment">//     如果是对象类型</span></span><br><span class="line">      <span class="comment">//     for (key in elements)</span></span><br><span class="line">      <span class="comment">//       if (callback.call(elements[key], key, elements[key]) === false) return elements</span></span><br><span class="line">      <span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//     return elements</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      <span class="comment">//问题在于为什么对 nodes 进行操作返回的是 dom? 是不是赋值操作是引用而不是复制?</span></span><br><span class="line">      <span class="comment">//字面量变量才是基本类型, 用 new 操作符都是对象类型,基本类型在栈内部,对象类型在堆内部,所以基本类型才会 play itself,</span></span><br><span class="line">      <span class="comment">//但是对象类型是 itself</span></span><br><span class="line">      <span class="comment">//因为这是引用类型,所以进行操作的时候 nodes 变, dom 也进行变值</span></span><br><span class="line">      <span class="comment">//所以返回的是 dom,为啥多费周章要多一个变量呀?</span></span><br><span class="line">      $.each(properties, <span class="function"><span class="keyword">function</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// methodAttributes = ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset']</span></span><br><span class="line">        <span class="comment">// console.log(nodes[key]);</span></span><br><span class="line">        <span class="built_in">console</span>.log(nodes);</span><br><span class="line">        <span class="comment">//如果有上面这些属性的话,就使用 Zepto 对象的方法赋值</span></span><br><span class="line">        <span class="keyword">if</span> (methodAttributes.indexOf(key) &gt; <span class="number">-1</span>) nodes[key](value)</span><br><span class="line">        <span class="comment">//如果不是就用 attr 方法</span></span><br><span class="line">        <span class="keyword">else</span> nodes.attr(key, value)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(nodes);</span><br><span class="line">    <span class="built_in">console</span>.log(dom);</span><br><span class="line">    <span class="built_in">console</span>.log(nodes === $(dom));<span class="comment">//是怎么判断两个变量是一样的?</span></span><br><span class="line">    <span class="keyword">return</span> dom;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></span><br><span class="line">  <span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></span><br><span class="line">  <span class="comment">// to the array. This method can be overridden in plugins.</span></span><br><span class="line"></span><br><span class="line">  zepto.Z = <span class="function"><span class="keyword">function</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个 Zepto 对象, Object =&gt; [dom, length, selector]</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Z(dom, selector)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.isZ` should return `true` if the given object is a Zepto</span></span><br><span class="line">  <span class="comment">// collection. This method can be overridden in plugins.</span></span><br><span class="line">  <span class="comment">//检验对象是不是 Zepto 对象</span></span><br><span class="line">  zepto.isZ = <span class="function"><span class="keyword">function</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> object <span class="keyword">instanceof</span> zepto.Z</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and</span></span><br><span class="line">  <span class="comment">// takes a CSS selector and an optional context (and handles various</span></span><br><span class="line">  <span class="comment">// special cases).</span></span><br><span class="line">  <span class="comment">// This method can be overridden in plugins.</span></span><br><span class="line">  <span class="comment">// $() 这个函数, 这是 Zepto 起手式, 最核心的 API</span></span><br><span class="line">  zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dom;</span><br><span class="line">    <span class="comment">// If nothing given, return an empty Zepto collection</span></span><br><span class="line">    <span class="keyword">if</span> (!selector) &#123;</span><br><span class="line">      <span class="comment">//如果没有选择器,那么返回一个 zepto 对象</span></span><br><span class="line">      <span class="comment">//zepto.Z = function(dom, selector) &#123;</span></span><br><span class="line">      <span class="comment">//    return new Z(dom, selector)</span></span><br><span class="line">      <span class="comment">//&#125;</span></span><br><span class="line">      <span class="comment">//function Z(dom, selector) &#123;</span></span><br><span class="line">        <span class="comment">//var i, len = dom ? dom.length : 0</span></span><br><span class="line">        <span class="comment">//for (i = 0; i &lt; len; i++) this[i] = dom[i]</span></span><br><span class="line">        <span class="comment">//this.length = len</span></span><br><span class="line">        <span class="comment">//this.selector = selector || ''</span></span><br><span class="line">      <span class="comment">//&#125;</span></span><br><span class="line">      <span class="comment">//返回一个 Zepto 对象可以使用 Zepto 中的工具函数</span></span><br><span class="line">      <span class="keyword">return</span> zepto.Z()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果有选择器  </span></span><br><span class="line">    <span class="comment">// Optimize for string selectors</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'string'</span>) &#123;</span><br><span class="line">      <span class="comment">// return str.replace(/(^\s* | \s*$)/g, '');</span></span><br><span class="line">      <span class="comment">//去除字符串的前后空格 // str == null ? '' : String.prototype.trim.call(str)</span></span><br><span class="line">      selector = selector.trim() </span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></span><br><span class="line">      <span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">//如果是 html 标签</span></span><br><span class="line">      <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; fragmentRE.test(selector))</span><br><span class="line">        <span class="comment">//看一下 fragment 函数</span></span><br><span class="line">        dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="comment">//如果 context 变量有值,先找到这个 context, 再从这里找值</span></span><br><span class="line">      <span class="comment">// find() 函数?</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</span><br><span class="line">      <span class="comment">// If it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="comment">//如果只有选择器,则从 document 对象中查找元素</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// If a function is given, call it when the DOM is ready</span></span><br><span class="line">    <span class="comment">//selector 不是选择器,而是一个函数</span></span><br><span class="line">    <span class="comment">//如果这个 selector 是一个函数对象, 那么就在 ready 执行这个函数</span></span><br><span class="line">    <span class="comment">//而 ready 状态对应的是 DOMContentLoaded 事件或者 load 事件(document 的 DOMContentLoaded 或者是 window 的 load</span></span><br><span class="line">    <span class="comment">//事件)</span></span><br><span class="line">    <span class="comment">//如果是原生函数对象</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector)</span><br><span class="line">    <span class="comment">// If a Zepto collection is given, just return it</span></span><br><span class="line">    <span class="comment">//如果是 Zepto 对象,返回这个 Zepto 对象</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) <span class="keyword">return</span> selector</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// normalize array if an array of nodes is given</span></span><br><span class="line">      <span class="comment">// 如果传入的参数是 DOM 节点,那么就将这些 DOM 节点规范化,所谓规范化就是将 DOM 对象以数组形式返回</span></span><br><span class="line">      <span class="comment">//如果是数组</span></span><br><span class="line">      <span class="comment">//function compact(array) &#123; return filter.call(array, function(item)&#123; return item != null &#125;) &#125;</span></span><br><span class="line">      <span class="comment">//emptyArray = [],  </span></span><br><span class="line">      <span class="comment">//filter = emptyArray.filter</span></span><br><span class="line">      <span class="comment">//使用原生对象的 filter 方法,</span></span><br><span class="line">      <span class="keyword">if</span> (isArray(selector)) &#123;</span><br><span class="line">        dom = compact(selector);</span><br><span class="line">        <span class="built_in">console</span>.log(dom); </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Wrap DOM nodes.</span></span><br><span class="line">      <span class="comment">// 如果是 DOM 原生对象</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector))</span><br><span class="line">        <span class="comment">// DOM 原生对象转化为数组</span></span><br><span class="line">        dom = [selector], selector = <span class="literal">null</span></span><br><span class="line">      <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">      <span class="comment">//如果是 HTML 字符串,则创建 HTML 节点</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</span><br><span class="line">        <span class="comment">//使用 fragment API 创建 HTML 节点</span></span><br><span class="line">        dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">      <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">      <span class="comment">// nodes from there</span></span><br><span class="line">      <span class="comment">// 如果有 context 变量(即 $('#id', $('body')))</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</span><br><span class="line">      <span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create a new Zepto collection from the nodes found</span></span><br><span class="line">    <span class="comment">//最终是返回一个 Zepto 对象</span></span><br><span class="line">    <span class="keyword">return</span> zepto.Z(dom, selector)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$` will be the base `Zepto` object. When calling this</span></span><br><span class="line">  <span class="comment">// function just call `$.zepto.init, which makes the implementation</span></span><br><span class="line">  <span class="comment">// details of selecting nodes and creating Zepto collections</span></span><br><span class="line">  <span class="comment">// patchable in plugins.</span></span><br><span class="line">  $ = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//这就是我们常用的 $ 函数</span></span><br><span class="line">    <span class="keyword">return</span> zepto.init(selector, context)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">target, source, deep</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> source)</span><br><span class="line">      <span class="keyword">if</span> (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key]))</span><br><span class="line">          target[key] = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> (isArray(source[key]) &amp;&amp; !isArray(target[key]))</span><br><span class="line">          target[key] = []</span><br><span class="line">        extend(target[key], source[key], deep)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) target[key] = source[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy all but undefined properties from one or more</span></span><br><span class="line">  <span class="comment">// objects to the `target` object.</span></span><br><span class="line">  $.extend = <span class="function"><span class="keyword">function</span>(<span class="params">target</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> deep, args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">'boolean'</span>) &#123;</span><br><span class="line">      deep = target</span><br><span class="line">      target = args.shift()</span><br><span class="line">    &#125;</span><br><span class="line">    args.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">arg</span>)</span>&#123; extend(target, arg, deep) &#125;)</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.qsa` is Zepto's CSS selector implementation which</span></span><br><span class="line">  <span class="comment">// uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.</span></span><br><span class="line">  <span class="comment">// This method can be overridden in plugins.</span></span><br><span class="line">  <span class="comment">//这个函数是用来选择 CSS 选择器的 querySelectorAll(核心方法)</span></span><br><span class="line">  zepto.qsa = <span class="function"><span class="keyword">function</span>(<span class="params">element, selector</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> found,</span><br><span class="line">        maybeID = selector[<span class="number">0</span>] == <span class="string">'#'</span>, <span class="comment">//如果有 # 符号就是 id 选择器</span></span><br><span class="line">        maybeClass = !maybeID &amp;&amp; selector[<span class="number">0</span>] == <span class="string">'.'</span>,  <span class="comment">// 如果没有,有 . 则是类选择器</span></span><br><span class="line">        <span class="comment">//如果只有标签名(没有 id 也没有类) 下面的表达式意思是如果有 id 或 类,则取符号后的名字,如果没有类和名字,则选择出单标签名</span></span><br><span class="line">        nameOnly = maybeID || maybeClass ? selector.slice(<span class="number">1</span>) : selector, <span class="comment">// Ensure that a 1 char tag name still gets checked</span></span><br><span class="line">        <span class="comment">//看是不是只有一个选择器</span></span><br><span class="line">        isSimple = simpleSelectorRE.test(nameOnly)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第一个判断 element.getElementById 这个方法是否存在, 是不是一个单选择器, 是不是 id 选择器</span></span><br><span class="line">    <span class="keyword">return</span> (element.getElementById &amp;&amp; isSimple &amp;&amp; maybeID) ? <span class="comment">// Safari DocumentFragment doesn't have getElementById</span></span><br><span class="line">      <span class="comment">//如果是使用 getElementById 找到元素, 如果能找到,则以数组的形式返回,如果没有则返回空数组, 问题在于为什么要用数组的形式?</span></span><br><span class="line">      ( (found = element.getElementById(nameOnly)) ? [found] : [] ) :</span><br><span class="line">      <span class="comment">//如果不存在 getElementById 这个方法, 或者多重选择(后代), 或者不是 id 选择器</span></span><br><span class="line">      <span class="comment">//则判断 如果不是元素节点(!== 1) 或不是 document (根节点 !== 9) 或者不是 文档片段类型documentFragment(!== 11)</span></span><br><span class="line">      <span class="comment">//则返回空数组,因为其他节点找不到元素</span></span><br><span class="line">      (element.nodeType !== <span class="number">1</span> &amp;&amp; element.nodeType !== <span class="number">9</span> &amp;&amp; element.nodeType !== <span class="number">11</span>) ? [] :</span><br><span class="line">      <span class="comment">//如果是元素节点或者 document 或 documentFragment 节点</span></span><br><span class="line">      <span class="comment">// slice: function()&#123;</span></span><br><span class="line">      <span class="comment">//return $(slice.apply(this, arguments))</span></span><br><span class="line">      <span class="comment">//&#125;,</span></span><br><span class="line">      slice.call(</span><br><span class="line">        <span class="comment">//判断是否单选择, 不是 id 选择器, 有 getElementByClassName 方法</span></span><br><span class="line">        isSimple &amp;&amp; !maybeID &amp;&amp; element.getElementsByClassName ? <span class="comment">// DocumentFragment doesn't have getElementsByClassName/TagName</span></span><br><span class="line">          <span class="comment">//第一层判断的前选择, 如果不是单选择 id 选择器</span></span><br><span class="line">          <span class="comment">//第二层判断</span></span><br><span class="line">          <span class="comment">//如果是 class 则使用 getElementByClassName()</span></span><br><span class="line">          maybeClass ? element.getElementsByClassName(nameOnly) : <span class="comment">// If it's simple, it could be a class</span></span><br><span class="line">          <span class="comment">//不是则是标签, getElementByTagName() </span></span><br><span class="line">          element.getElementsByTagName(selector) : <span class="comment">// Or a tag</span></span><br><span class="line">          <span class="comment">//这个是第一层判断的后选择</span></span><br><span class="line">          <span class="comment">//如果不是简单选择,则要将所有的元素选择出来使用 querySelectorAll() 试一下用这个 API</span></span><br><span class="line">          element.querySelectorAll(selector) <span class="comment">// Or it's not simple, and we need to query all</span></span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">filtered</span>(<span class="params">nodes, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> selector == <span class="literal">null</span> ? $(nodes) : $(nodes).filter(selector)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.contains = <span class="built_in">document</span>.documentElement.contains ?</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> parent !== node &amp;&amp; parent.contains(node)</span><br><span class="line">    &#125; :</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">parent, node</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (node &amp;&amp; (node = node.parentNode))</span><br><span class="line">        <span class="keyword">if</span> (node === parent) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">funcArg</span>(<span class="params">context, arg, idx, payload</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isFunction(arg) ? arg.call(context, idx, payload) : arg</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setAttribute</span>(<span class="params">node, name, value</span>) </span>&#123;</span><br><span class="line">    value == <span class="literal">null</span> ? node.removeAttribute(name) : node.setAttribute(name, value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// access className property while respecting SVGAnimatedString</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">className</span>(<span class="params">node, value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> klass = node.className || <span class="string">''</span>,</span><br><span class="line">        svg   = klass &amp;&amp; klass.baseVal !== <span class="literal">undefined</span></span><br><span class="line">        <span class="comment">// console.log(klass.baseVal);</span></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> svg ? klass.baseVal : klass</span><br><span class="line">    svg ? (klass.baseVal = value) : (node.className = value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// "true"  =&gt; true</span></span><br><span class="line">  <span class="comment">// "false" =&gt; false</span></span><br><span class="line">  <span class="comment">// "null"  =&gt; null</span></span><br><span class="line">  <span class="comment">// "42"    =&gt; 42</span></span><br><span class="line">  <span class="comment">// "42.5"  =&gt; 42.5</span></span><br><span class="line">  <span class="comment">// "08"    =&gt; "08"</span></span><br><span class="line">  <span class="comment">// JSON    =&gt; parse if valid</span></span><br><span class="line">  <span class="comment">// String  =&gt; self</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">deserializeValue</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value ?</span><br><span class="line">        value == <span class="string">"true"</span> ||</span><br><span class="line">        ( value == <span class="string">"false"</span> ? <span class="literal">false</span> :</span><br><span class="line">          value == <span class="string">"null"</span> ? <span class="literal">null</span> :</span><br><span class="line">          +value + <span class="string">""</span> == value ? +value :</span><br><span class="line">          /^[\[\&#123;]/.test(value) ? $.parseJSON(value) :</span><br><span class="line">          value )</span><br><span class="line">        : value</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//====================静态方法集==================================</span></span><br><span class="line">  $.type = type</span><br><span class="line">  $.isFunction = isFunction</span><br><span class="line">  $.isWindow = isWindow</span><br><span class="line">  $.isArray = isArray</span><br><span class="line">  $.isPlainObject = isPlainObject</span><br><span class="line"></span><br><span class="line">  $.isEmptyObject = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name</span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.isNumeric = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> num = <span class="built_in">Number</span>(val), type = <span class="keyword">typeof</span> val</span><br><span class="line">    <span class="keyword">return</span> val != <span class="literal">null</span> &amp;&amp; type != <span class="string">'boolean'</span> &amp;&amp;</span><br><span class="line">      (type != <span class="string">'string'</span> || val.length) &amp;&amp;</span><br><span class="line">      !<span class="built_in">isNaN</span>(num) &amp;&amp; <span class="built_in">isFinite</span>(num) || <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.inArray = <span class="function"><span class="keyword">function</span>(<span class="params">elem, array, i</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> emptyArray.indexOf.call(array, elem, i)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.camelCase = camelize</span><br><span class="line">  <span class="comment">//去除字符串空格</span></span><br><span class="line">  $.trim = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str == <span class="literal">null</span> ? <span class="string">""</span> : <span class="built_in">String</span>.prototype.trim.call(str)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// plugin compatibility</span></span><br><span class="line">  $.uuid = <span class="number">0</span></span><br><span class="line">  $.support = &#123; &#125;</span><br><span class="line">  $.expr = &#123; &#125;</span><br><span class="line">  $.noop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  <span class="comment">//接收一个数组,利用 callback 函数来返回一个符合条件的数组</span></span><br><span class="line">  $.map = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value, values = [], i, key</span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements))</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++) &#123;</span><br><span class="line">        value = callback(elements[i], i)</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value)</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements) &#123;</span><br><span class="line">        value = callback(elements[key], key)</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) values.push(value)</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">//将数组 values 扁平化,所谓扁平化就是</span></span><br><span class="line">    <span class="keyword">return</span> flatten(values)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.each = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, key</span><br><span class="line">    <span class="keyword">if</span> (likeArray(elements)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[i], i, elements[i]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</span><br><span class="line">        <span class="keyword">if</span> (callback.call(elements[key], key, elements[key]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> elements</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.grep = <span class="function"><span class="keyword">function</span>(<span class="params">elements, callback</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filter.call(elements, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.JSON) $.parseJSON = <span class="built_in">JSON</span>.parse</span><br><span class="line">  <span class="comment">//====================静态方法集 end ==================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Populate the class2type map</span></span><br><span class="line">  $.each(<span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">    class2type[ <span class="string">"[object "</span> + name + <span class="string">"]"</span> ] = name.toLowerCase()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Define methods that will be available on all</span></span><br><span class="line">  <span class="comment">// Zepto collections</span></span><br><span class="line">  <span class="comment">//工具函数,扩充丰富 Zepto 对象原型链 操作集</span></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    <span class="keyword">constructor</span>: zepto.Z,</span><br><span class="line">    length: 0,</span><br><span class="line"></span><br><span class="line">    // Because a collection acts like an array</span><br><span class="line">    // copy over these useful array functions.</span><br><span class="line">    //================数组方法集==================</span><br><span class="line">    forEach: emptyArray.forEach,</span><br><span class="line">    reduce: emptyArray.reduce,</span><br><span class="line">    push: emptyArray.push,</span><br><span class="line">    sort: emptyArray.sort,</span><br><span class="line">    splice: emptyArray.splice,</span><br><span class="line">    indexOf: emptyArray.indexOf,</span><br><span class="line">    //================数组方法集 end =============</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    //拼接 API, 拼接数组</span><br><span class="line">    concat: function()&#123;</span><br><span class="line">      <span class="keyword">var</span> i, value, args = []</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">        value = <span class="built_in">arguments</span>[i]</span><br><span class="line">        args[i] = zepto.isZ(value) ? value.toArray() : value</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//使用数组原生的 concat 方法,如果是 Zepto 对象,则将对象转化为数组,否则直接拼接</span></span><br><span class="line">      <span class="comment">//将 args 数组与 Zepto 原本的数组进行拼接</span></span><br><span class="line">      <span class="keyword">return</span> concat.apply(zepto.isZ(<span class="keyword">this</span>) ? <span class="keyword">this</span>.toArray() : <span class="keyword">this</span>, args)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `map` and `slice` in the jQuery API work differently</span></span><br><span class="line">    <span class="comment">// from their array counterparts</span></span><br><span class="line">    <span class="comment">//将原数组以 callback 希望的形式重新组合</span></span><br><span class="line">    map: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $($.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, i</span>)</span>&#123; <span class="keyword">return</span> fn.call(el, i, el) &#125;))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//对原生的 Array slice 包装(数组选取方法)</span></span><br><span class="line">    slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(slice.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//ready 函数, 用于在文档加载完毕后执行函数</span></span><br><span class="line">    ready: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">      <span class="comment">// don't use "interactive" on IE &lt;= 10 (it can fired premature)</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">document</span>.readyState === <span class="string">"complete"</span> ||</span><br><span class="line">          (<span class="built_in">document</span>.readyState !== <span class="string">"loading"</span> &amp;&amp; !<span class="built_in">document</span>.documentElement.doScroll))</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; callback($) &#125;, <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> handler = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">document</span>.removeEventListener(<span class="string">"DOMContentLoaded"</span>, handler, <span class="literal">false</span>)</span><br><span class="line">          <span class="built_in">window</span>.removeEventListener(<span class="string">"load"</span>, handler, <span class="literal">false</span>)</span><br><span class="line">          callback($)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">document</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>, handler, <span class="literal">false</span>)</span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, handler, <span class="literal">false</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//如果传入的参数 idx(index) 是 undefinded(未传参数),那么就返回这个数组</span></span><br><span class="line">    <span class="comment">//如果有 idx, 先判断 idx 是大于 0,还是小于零</span></span><br><span class="line">    <span class="comment">//如果大于 0, 则返回数组对象中的下标元素,这时是 DOM 元素 this[idx]</span></span><br><span class="line">    <span class="comment">//小于 0,则是从数组后面开始选取元素  this[idx + this.length] </span></span><br><span class="line">    <span class="comment">//用法: array.get(0);</span></span><br><span class="line">    get: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> idx === <span class="literal">undefined</span> ? slice.call(<span class="keyword">this</span>) : <span class="keyword">this</span>[idx &gt;= <span class="number">0</span> ? idx : idx + <span class="keyword">this</span>.length]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//将对象转化为数组</span></span><br><span class="line">    toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.get() &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回数组长度</span></span><br><span class="line">    size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//从有效的父元素中删除这个子元素</span></span><br><span class="line">    remove: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parentNode != <span class="literal">null</span>)</span><br><span class="line">          <span class="keyword">this</span>.parentNode.removeChild(<span class="keyword">this</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//遍历数组</span></span><br><span class="line">    <span class="comment">//需要弄懂原生的 every,原生 every 接收一个函数,如果返回 false 就停止循环, 理解 every 与 map, some, forEach, filter 区别</span></span><br><span class="line">    <span class="comment">//every 就是每个都, filter 选出符合条件的, some 是只要有, forEach 是每一个都要做某事, map 是每个做完某事后排队 </span></span><br><span class="line">    each: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">      emptyArray.every.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el, idx</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> callback.call(el, idx, el) !== <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//其实是对数组类型的 filter 函数包装</span></span><br><span class="line">    filter: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> <span class="keyword">this</span>.not(<span class="keyword">this</span>.not(selector))</span><br><span class="line">      <span class="keyword">return</span> $(filter.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> zepto.matches(element, selector)</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在某个元素集合中添加元素</span></span><br><span class="line">    add: <span class="function"><span class="keyword">function</span>(<span class="params">selector,context</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(uniq(<span class="keyword">this</span>.concat($(selector,context))))</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断数组中的第一个元素是不是符合 CSS 选择器</span></span><br><span class="line">    is: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="comment">//没有找到即不是的时候, zepto.matches 返回 -1(false)</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length &gt; <span class="number">0</span> &amp;&amp; zepto.matches(<span class="keyword">this</span>[<span class="number">0</span>], selector)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//与 filter 相反的功能,将不符合的元素选出来</span></span><br><span class="line">    not: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> nodes=[]</span><br><span class="line">      <span class="keyword">if</span> (isFunction(selector) &amp;&amp; selector.call !== <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="comment">//如果不包含(不符合 selector 条件), 将该元素加入 nodes 数组中</span></span><br><span class="line">          <span class="keyword">if</span> (!selector.call(<span class="keyword">this</span>,idx)) nodes.push(<span class="keyword">this</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果是字符串参数(CSS 选择器), 先找到符合条件的元素</span></span><br><span class="line">        <span class="keyword">var</span> excludes = <span class="keyword">typeof</span> selector == <span class="string">'string'</span> ? <span class="keyword">this</span>.filter(selector) :</span><br><span class="line">        <span class="comment">//如果不是字符串参数,如果是一个类数组对象,或者函数对象,则将这个类数组对象转化为数组,否则新建一个 Zepto 对象(数组形式)</span></span><br><span class="line">          (likeArray(selector) &amp;&amp; isFunction(selector.item)) ? slice.call(selector) : $(selector)</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果 excludes 不包含数组中的元素,则将这个不包含在内的元素加入到 nodes 中</span></span><br><span class="line">        <span class="keyword">this</span>.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (excludes.indexOf(el) &lt; <span class="number">0</span>) nodes.push(el)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//返回 nodes </span></span><br><span class="line">      <span class="keyword">return</span> $(nodes)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否包含符合条件的元素</span></span><br><span class="line">    has: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="comment">//过滤出符合条件的元素</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isObject(selector) ?</span><br><span class="line">          <span class="comment">//如果 selector 是对象</span></span><br><span class="line">          <span class="comment">//</span></span><br><span class="line">          $.contains(<span class="keyword">this</span>, selector) :</span><br><span class="line">          <span class="comment">//selector 不是对象(是字符串)</span></span><br><span class="line">          <span class="comment">//如果有找到匹配的元素,就会有数组长度,但是没有数组长度,即返回 0 ,则 filter 就会不收纳这个元素</span></span><br><span class="line">          $(<span class="keyword">this</span>).find(selector).size()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//寻找集合中的某个元素</span></span><br><span class="line">    eq: <span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(idx + <span class="number">1</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(+ idx);</span><br><span class="line">      <span class="built_in">console</span>.log(+ idx + <span class="number">1</span>);</span><br><span class="line">      <span class="comment">//这里巧妙的在于在 idx 前面添加一个 '+', 将字符串值转化为真正的数值</span></span><br><span class="line">      <span class="comment">//如果直接是 idx + 1, 有可能会是字符串拼接,但是使用 + idx + 1 的话会将 idx 先转化为数值再 + 1</span></span><br><span class="line">      <span class="keyword">return</span> idx === <span class="number">-1</span> ? <span class="keyword">this</span>.slice(idx) : <span class="keyword">this</span>.slice(idx, + idx + <span class="number">1</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//集合中的第一个元素</span></span><br><span class="line">    first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//集合中的最后一个元素</span></span><br><span class="line">    last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="keyword">this</span>[<span class="keyword">this</span>.length - <span class="number">1</span>]</span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !isObject(el) ? el : $(el)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//寻找元素</span></span><br><span class="line">    find: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123; <span class="comment">//传入选择器字符串</span></span><br><span class="line">      <span class="keyword">var</span> result, $<span class="keyword">this</span> = <span class="keyword">this</span>  <span class="comment">//这里的 this 是 Zepto 对象</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'$this is '</span> + $<span class="keyword">this</span>);</span><br><span class="line">      <span class="built_in">console</span>.log($<span class="keyword">this</span>);</span><br><span class="line">      <span class="comment">//如果没有传入 selector, 那么返回一个空 Zepto 对象</span></span><br><span class="line">      <span class="keyword">if</span> (!selector) result = $()</span><br><span class="line">      <span class="comment">//如果是一个 DOM 对象</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'object'</span>) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'object'</span>);</span><br><span class="line">          <span class="comment">//result 等于过滤后的数组</span></span><br><span class="line">          result = $(selector).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">var</span> node = <span class="keyword">this</span></span><br><span class="line">          <span class="comment">//这里的 parent 是当前调用 API 的元素, function(currentVal, index, arr)&#123;&#125;</span></span><br><span class="line">          <span class="keyword">return</span> emptyArray.some.call($<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'parent is '</span> + parent);</span><br><span class="line">            <span class="built_in">console</span>.log(parent);</span><br><span class="line">            <span class="keyword">return</span> $.contains(parent, node)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)        </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//如果是一个 Zepto 对象,且对象 length 长度为 1</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.length == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'string!!!!!!!'</span>);</span><br><span class="line">        result = $(zepto.qsa(<span class="keyword">this</span>[<span class="number">0</span>], selector)); </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//否则(Zepto 对象, 对象数组长度大于 1 )</span></span><br><span class="line">      <span class="comment">//result 为返回数组</span></span><br><span class="line">      <span class="keyword">else</span> result = <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">        <span class="keyword">return</span> zepto.qsa(<span class="keyword">this</span>, selector) </span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取符合 CSS 选择器的第一个父元素</span></span><br><span class="line">    closest: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>)</span>&#123;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="keyword">var</span> nodes = [], collection = <span class="keyword">typeof</span> selector == <span class="string">'object'</span> &amp;&amp; $(selector)</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, node</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//存在 node, 并且 node 不包含符合选择器的元素, 直到找到包含选择器的 node </span></span><br><span class="line">        <span class="keyword">while</span> (node &amp;&amp; !(collection ? collection.indexOf(node) &gt;= <span class="number">0</span> : zepto.matches(node, selector)))</span><br><span class="line">          <span class="comment">//选择 node 的父元素</span></span><br><span class="line">          node = node !== context &amp;&amp; !isDocument(node) &amp;&amp; node.parentNode</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (node &amp;&amp; nodes.indexOf(node) &lt; <span class="number">0</span>) nodes.push(node)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="keyword">return</span> $(nodes)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//==================================== DOM 操作 =============================================</span></span><br><span class="line">    <span class="comment">//返回集合中所有的父元素, 过滤符合条件的父元素</span></span><br><span class="line">    parents: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> ancestors = [], nodes = <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">while</span> (nodes.length &gt; <span class="number">0</span>)</span><br><span class="line">        nodes = $.map(nodes, <span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</span><br><span class="line">          <span class="comment">//node 存在父元素, node 不是 document 类型, node 不存在于 ancestors 中(保证 node 在 ancestors 的唯一性)</span></span><br><span class="line">          <span class="keyword">if</span> ((node = node.parentNode) &amp;&amp; !isDocument(node) &amp;&amp; ancestors.indexOf(node) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            ancestors.push(node)</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">return</span> filtered(ancestors, selector)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//直接获取父元素</span></span><br><span class="line">    parent: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="comment">//使用 pluck 返回 parentNode, 然后将返回来的对象过滤</span></span><br><span class="line">      <span class="keyword">return</span> filtered(uniq(<span class="keyword">this</span>.pluck(<span class="string">'parentNode'</span>)), selector)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回直接后代</span></span><br><span class="line">    children: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      <span class="comment">//返回后代元素之后再根据 selector 过滤</span></span><br><span class="line">      <span class="keyword">return</span> filtered(<span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> children(<span class="keyword">this</span>) &#125;), selector)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//内容</span></span><br><span class="line">    contents: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//返回元素包含的内容, 使用 DOM 的 contentDocument 属性或者 childNodes 返回内容</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.contentDocument || slice.call(<span class="keyword">this</span>.childNodes) &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//兄弟元素</span></span><br><span class="line">    siblings: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> filtered(<span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params">i, el</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//使用 el.parentNode, 过滤出 el.parentNode 的子元素, 但是不包括 this 中的元素</span></span><br><span class="line">        <span class="keyword">return</span> filter.call(children(el.parentNode), <span class="function"><span class="keyword">function</span>(<span class="params">child</span>)</span>&#123; <span class="keyword">return</span> child!==el &#125;)</span><br><span class="line">      &#125;), selector)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//清空后代</span></span><br><span class="line">    empty: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">//使用 innerHTML 为 '', 高效有效地清空子元素</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.innerHTML = <span class="string">''</span> &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// `pluck` is borrowed from Prototype.js</span></span><br><span class="line">    <span class="comment">//使用对象方括号访问 DOM 对象的 parentNode 等属性</span></span><br><span class="line">    pluck: <span class="function"><span class="keyword">function</span>(<span class="params">property</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123; <span class="keyword">return</span> el[property] &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//动效 API , 显示</span></span><br><span class="line">    show: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.style.display == <span class="string">"none"</span> &amp;&amp; (<span class="keyword">this</span>.style.display = <span class="string">''</span>)</span><br><span class="line">        <span class="comment">//使用 web api-- getComputedStyle 获取 CSS 样式(元素, 样式)</span></span><br><span class="line">        <span class="comment">//这里明显是获取本元素全部样式属性</span></span><br><span class="line">        <span class="keyword">if</span> (getComputedStyle(<span class="keyword">this</span>, <span class="string">''</span>).getPropertyValue(<span class="string">"display"</span>) == <span class="string">"none"</span>)</span><br><span class="line">          <span class="keyword">this</span>.style.display = defaultDisplay(<span class="keyword">this</span>.nodeName)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//替换内容</span></span><br><span class="line">    replaceWith: <span class="function"><span class="keyword">function</span>(<span class="params">newContent</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.before);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.before(newContent).remove()</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//=============================== 包裹元素 ================================</span></span><br><span class="line">    wrap: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure)</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; !func)</span><br><span class="line">        <span class="keyword">var</span> dom   = $(structure).get(<span class="number">0</span>),</span><br><span class="line">            clone = dom.parentNode || <span class="keyword">this</span>.length &gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">        $(<span class="keyword">this</span>).wrapAll(</span><br><span class="line">          func ? structure.call(<span class="keyword">this</span>, index) :</span><br><span class="line">            clone ? dom.cloneNode(<span class="literal">true</span>) : dom</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    wrapAll: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">        $(<span class="keyword">this</span>[<span class="number">0</span>]).before(structure = $(structure))</span><br><span class="line">        <span class="keyword">var</span> children</span><br><span class="line">        <span class="comment">// drill down to the inmost element</span></span><br><span class="line">        <span class="keyword">while</span> ((children = structure.children()).length) structure = children.first()</span><br><span class="line">        $(structure).append(<span class="keyword">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    wrapInner: <span class="function"><span class="keyword">function</span>(<span class="params">structure</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> func = isFunction(structure)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = $(<span class="keyword">this</span>), contents = self.contents(),</span><br><span class="line">            dom  = func ? structure.call(<span class="keyword">this</span>, index) : structure</span><br><span class="line">        contents.length ? contents.wrapAll(dom) : self.append(dom)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    unwrap: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.parent().each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $(<span class="keyword">this</span>).replaceWith($(<span class="keyword">this</span>).children())</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//=============================== 包裹元素 end ================================</span></span><br><span class="line"></span><br><span class="line">    clone: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.cloneNode(<span class="literal">true</span>) &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.css(<span class="string">"display"</span>, <span class="string">"none"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    toggle: <span class="function"><span class="keyword">function</span>(<span class="params">setting</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> el = $(<span class="keyword">this</span>)</span><br><span class="line">        <span class="comment">//这些前面加 ';' 是为了避免在多文件压缩的时候出现缺少 ; 的错误 </span></span><br><span class="line">        ;(setting === <span class="literal">undefined</span> ? el.css(<span class="string">"display"</span>) == <span class="string">"none"</span> : setting) ? el.show() : el.hide()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历</span></span><br><span class="line">    prev: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123; <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">'previousElementSibling'</span>)).filter(selector || <span class="string">'*'</span>) &#125;,</span><br><span class="line">    next: <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123; <span class="keyword">return</span> $(<span class="keyword">this</span>.pluck(<span class="string">'nextElementSibling'</span>)).filter(selector || <span class="string">'*'</span>) &#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    html: <span class="function"><span class="keyword">function</span>(<span class="params">html</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ?</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">var</span> originHtml = <span class="keyword">this</span>.innerHTML</span><br><span class="line">          $(<span class="keyword">this</span>).empty().append( funcArg(<span class="keyword">this</span>, html, idx, originHtml) )</span><br><span class="line">        &#125;) :</span><br><span class="line">        (<span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span> ? <span class="keyword">this</span>[<span class="number">0</span>].innerHTML : <span class="literal">null</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    text: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span> ?</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">var</span> newText = funcArg(<span class="keyword">this</span>, text, idx, <span class="keyword">this</span>.textContent)</span><br><span class="line">          <span class="keyword">this</span>.textContent = newText == <span class="literal">null</span> ? <span class="string">''</span> : <span class="string">''</span>+newText</span><br><span class="line">        &#125;) :</span><br><span class="line">        (<span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span> ? <span class="keyword">this</span>.pluck(<span class="string">'textContent'</span>).join(<span class="string">""</span>) : <span class="literal">null</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//===============================DOM 操作 END ==================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//============================================属性操作===============================================</span></span><br><span class="line">    <span class="comment">//设置属性值或获取属性值</span></span><br><span class="line">    attr: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> result</span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">typeof</span> name == <span class="string">'string'</span> &amp;&amp; !(<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>)) ?</span><br><span class="line">        <span class="comment">//getAttirbute 是 DOM 原生的属性操作方法</span></span><br><span class="line">        (<span class="number">0</span> <span class="keyword">in</span> <span class="keyword">this</span> &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>].nodeType == <span class="number">1</span> &amp;&amp; (result = <span class="keyword">this</span>[<span class="number">0</span>].getAttribute(name)) != <span class="literal">null</span> ? result : <span class="literal">undefined</span>) :</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">this</span>.nodeType !== <span class="number">1</span>) <span class="keyword">return</span></span><br><span class="line">          <span class="keyword">if</span> (isObject(name)) <span class="keyword">for</span> (key <span class="keyword">in</span> name) setAttribute(<span class="keyword">this</span>, key, name[key])</span><br><span class="line">            <span class="comment">//在 setAtteribute 中利用的就是 DOM 自带的 setAttribute 与 removeAttribute</span></span><br><span class="line">          <span class="keyword">else</span> setAttribute(<span class="keyword">this</span>, name, funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.getAttribute(name)))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//移除属性值</span></span><br><span class="line">    removeAttr: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.nodeType === <span class="number">1</span> &amp;&amp; name.split(<span class="string">' '</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">attribute</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//在 setAtteribute 中利用的就是 DOM 自带的 setAttribute 与 removeAttribute</span></span><br><span class="line">        setAttribute(<span class="keyword">this</span>, attribute)</span><br><span class="line">      &#125;, <span class="keyword">this</span>)&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//读取属性</span></span><br><span class="line">    prop: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</span><br><span class="line">      name = propMap[name] || name</span><br><span class="line">      <span class="keyword">return</span> (<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) ?</span><br><span class="line">        <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">this</span>[name] = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>[name])</span><br><span class="line">        &#125;) :</span><br><span class="line">        (<span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">this</span>[<span class="number">0</span>][name])</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//移除属性</span></span><br><span class="line">    removeProp: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      name = propMap[name] || name</span><br><span class="line">      <span class="comment">//值得注意的是这里使用 delete 操作符来完成移除操作, 但是像 className 这些属性浏览器禁止移除</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">delete</span> <span class="keyword">this</span>[name] &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//读取或写入 data 属性(自定义属性)</span></span><br><span class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> attrName = <span class="string">'data-'</span> + name.replace(capitalRE, <span class="string">'-$1'</span>).toLowerCase()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> data = (<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) ?</span><br><span class="line">        <span class="keyword">this</span>.attr(attrName, value) :</span><br><span class="line">        <span class="keyword">this</span>.attr(attrName)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> data !== <span class="literal">null</span> ? deserializeValue(data) : <span class="literal">undefined</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//设置或获取元素的值</span></span><br><span class="line">    val: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="number">0</span> <span class="keyword">in</span> <span class="built_in">arguments</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) value = <span class="string">""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.value = funcArg(<span class="keyword">this</span>, value, idx, <span class="keyword">this</span>.value)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; (<span class="keyword">this</span>[<span class="number">0</span>].multiple ?</span><br><span class="line">           $(<span class="keyword">this</span>[<span class="number">0</span>]).find(<span class="string">'option'</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.selected &#125;).pluck(<span class="string">'value'</span>) :</span><br><span class="line">           <span class="keyword">this</span>[<span class="number">0</span>].value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//是否有这个类名</span></span><br><span class="line">    hasClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">      <span class="comment">//需要知道 some 方法的使用详解, some(callback[, thisObject]);</span></span><br><span class="line">      <span class="comment">//如果在 callback 函数后面加上一些变量或者值, this 值就变成传入的那个值</span></span><br><span class="line">      <span class="comment">//Array.prototype.some.call([ele], function(ele)&#123;</span></span><br><span class="line">      <span class="comment">//    console.log(this);  这里的 this 是后面传入的值 /\s/ 或 true(包装类型) </span></span><br><span class="line">      <span class="comment">//&#125;, /\s/或 true);</span></span><br><span class="line">      <span class="keyword">return</span> emptyArray.some.call(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(el);</span><br><span class="line">        <span class="built_in">console</span>.log(className(el));</span><br><span class="line">        <span class="built_in">console</span>.log(classRE(name));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.test(className(el))</span><br><span class="line">      &#125;, classRE(name))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//添加某个类名</span></span><br><span class="line">    addClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">'className'</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">// console.log(this.className);</span></span><br><span class="line"></span><br><span class="line">        classList = []</span><br><span class="line">        <span class="keyword">var</span> cls = className(<span class="keyword">this</span>), newName = funcArg(<span class="keyword">this</span>, name, idx, cls)</span><br><span class="line">        <span class="comment">// console.log(this);</span></span><br><span class="line">        <span class="comment">//cls 是元素现有的类名, newName 是新增类名的字符串</span></span><br><span class="line">        newName.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</span><br><span class="line">          <span class="comment">//forEach 函数后面指定 this 为元素</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="keyword">this</span>);</span><br><span class="line">          <span class="comment">//如果元素中还没有这个类名,就将在这个类名加入 classlist 数组中</span></span><br><span class="line">          <span class="keyword">if</span> (!$(<span class="keyword">this</span>).hasClass(klass)) classList.push(klass)</span><br><span class="line">        &#125;, <span class="keyword">this</span>)</span><br><span class="line">        <span class="comment">//如果有新类名, 就将类名加入元素的 className 中</span></span><br><span class="line">        classList.length &amp;&amp; className(<span class="keyword">this</span>, cls + (cls ? <span class="string">" "</span> : <span class="string">""</span>) + classList.join(<span class="string">" "</span>))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//移除某个类名</span></span><br><span class="line">    removeClass: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">'className'</span> <span class="keyword">in</span> <span class="keyword">this</span>)) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> (name === <span class="literal">undefined</span>) <span class="keyword">return</span> className(<span class="keyword">this</span>, <span class="string">''</span>)</span><br><span class="line">        <span class="comment">//classlist 是类名数组</span></span><br><span class="line">        classList = className(<span class="keyword">this</span>)</span><br><span class="line">        funcArg(<span class="keyword">this</span>, name, idx, classList).split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</span><br><span class="line">          <span class="comment">//将要移除的类名替换成空格</span></span><br><span class="line">          classList = classList.replace(classRE(klass), <span class="string">" "</span>)</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//将元素的类名 className 替换成去除空格后的 classList</span></span><br><span class="line">        className(<span class="keyword">this</span>, classList.trim())</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//如果存在类名则移除,如果不存在则添加</span></span><br><span class="line">    toggleClass: <span class="function"><span class="keyword">function</span>(<span class="params">name, when</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!name) <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>), names = funcArg(<span class="keyword">this</span>, name, idx, className(<span class="keyword">this</span>))</span><br><span class="line">        names.split(<span class="regexp">/\s+/g</span>).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">klass</span>)</span>&#123;</span><br><span class="line">          (when === <span class="literal">undefined</span> ? !$<span class="keyword">this</span>.hasClass(klass) : when) ?</span><br><span class="line">            $<span class="keyword">this</span>.addClass(klass) : $<span class="keyword">this</span>.removeClass(klass)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//=======================================属性操作 end =============================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取数组的第几个元素</span></span><br><span class="line">    index: <span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> element ? <span class="keyword">this</span>.indexOf($(element)[<span class="number">0</span>]) : <span class="keyword">this</span>.parent().children().indexOf(<span class="keyword">this</span>[<span class="number">0</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//样式操作</span></span><br><span class="line">    <span class="comment">//有几种调用形式:</span></span><br><span class="line">    <span class="comment">//1.css('style'); 返回值</span></span><br><span class="line">    <span class="comment">//2.css('style', 'value'); 设置值</span></span><br><span class="line">    <span class="comment">//3.css('style', ''); 清空值</span></span><br><span class="line">    <span class="comment">//4.css(&#123; style: 'value'&#125;);  这样 length == 1 ,设置值</span></span><br><span class="line">    <span class="comment">//5.css([prop]);  读取值</span></span><br><span class="line">    css: <span class="function"><span class="keyword">function</span>(<span class="params">property, value</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">      <span class="comment">//(arguments 是类数组对象)</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="comment">//是第一,第五种调用形式</span></span><br><span class="line">        <span class="keyword">var</span> element = <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> property == <span class="string">'string'</span>) &#123;</span><br><span class="line">          <span class="comment">//第一种调用形式</span></span><br><span class="line">          <span class="comment">//如果没有 element,直接返回</span></span><br><span class="line">          <span class="keyword">if</span> (!element) <span class="keyword">return</span></span><br><span class="line">          <span class="comment">//如果有 element, 那么使用 style 对象访问[驼峰写法],或者使用 getComputedStyle(ele, null).getPropertyValue()</span></span><br><span class="line">          <span class="keyword">return</span> element.style[camelize(property)] || getComputedStyle(element, <span class="string">''</span>).getPropertyValue(property)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isArray(property)) &#123;</span><br><span class="line">          <span class="comment">//第五种形式</span></span><br><span class="line">          <span class="keyword">if</span> (!element) <span class="keyword">return</span></span><br><span class="line">          <span class="keyword">var</span> props = &#123;&#125;</span><br><span class="line">          <span class="keyword">var</span> computedStyle = getComputedStyle(element, <span class="string">''</span>)</span><br><span class="line">          $.each(property, <span class="function"><span class="keyword">function</span>(<span class="params">_, prop</span>)</span>&#123;</span><br><span class="line">            props[prop] = (element.style[camelize(prop)] || computedStyle.getPropertyValue(prop))</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">return</span> props</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//第二,三,四种调用方式</span></span><br><span class="line">      <span class="comment">//css 样式字符串</span></span><br><span class="line">      <span class="keyword">var</span> css = <span class="string">''</span></span><br><span class="line">      <span class="comment">//如果属性是字符串形式</span></span><br><span class="line">      <span class="keyword">if</span> (type(property) == <span class="string">'string'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!value &amp;&amp; value !== <span class="number">0</span>)</span><br><span class="line">          <span class="comment">//dasherize 是将驼峰写法转化为连接符写法,如果没有赋值或值为 undefined/null 的话, 那么就移除元素上的属性</span></span><br><span class="line">          <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.removeProperty(dasherize(property)) &#125;)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="comment">//拼接字符串</span></span><br><span class="line">          css = dasherize(property) + <span class="string">":"</span> + maybeAddPx(property, value)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果属性是对象形式</span></span><br><span class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> property)</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!property[key] &amp;&amp; property[key] !== <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.removeProperty(dasherize(key)) &#125;)</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="comment">//拼接字符串</span></span><br><span class="line">            css += dasherize(key) + <span class="string">':'</span> + maybeAddPx(key, property[key]) + <span class="string">';'</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//使用 cssText 与 css 字符串变量一次性写入修改操作,高效便捷</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.style.cssText += <span class="string">';'</span> + css &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取元素的相对 document 高度</span></span><br><span class="line">    offset: <span class="function"><span class="keyword">function</span>(<span class="params">coordinates</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (coordinates) <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">index</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>),</span><br><span class="line">            coords = funcArg(<span class="keyword">this</span>, coordinates, index, $<span class="keyword">this</span>.offset()),</span><br><span class="line">            parentOffset = $<span class="keyword">this</span>.offsetParent().offset(),</span><br><span class="line">            props = &#123;</span><br><span class="line">              top:  coords.top  - parentOffset.top,</span><br><span class="line">              left: coords.left - parentOffset.left</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($<span class="keyword">this</span>.css(<span class="string">'position'</span>) == <span class="string">'static'</span>) props[<span class="string">'position'</span>] = <span class="string">'relative'</span></span><br><span class="line">        $<span class="keyword">this</span>.css(props)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">document</span>.documentElement !== <span class="keyword">this</span>[<span class="number">0</span>] &amp;&amp; !$.contains(<span class="built_in">document</span>.documentElement, <span class="keyword">this</span>[<span class="number">0</span>]))</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span>&#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//getBoundingClientRect 可以获取元素的位置, 元素距离网页上沿的距离与距离网页左边的距离</span></span><br><span class="line">      <span class="comment">//计算 left, top 的值的时候为了兼容性问题,使用了 window.pageXoffset 或者 window.pageYOffset ,而不是 window.scrollTop, window.scrollLeft</span></span><br><span class="line">      <span class="keyword">var</span> obj = <span class="keyword">this</span>[<span class="number">0</span>].getBoundingClientRect()</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        left: obj.left + <span class="built_in">window</span>.pageXOffset,</span><br><span class="line">        top: obj.top + <span class="built_in">window</span>.pageYOffset,</span><br><span class="line">        width: <span class="built_in">Math</span>.round(obj.width),</span><br><span class="line">        height: <span class="built_in">Math</span>.round(obj.height)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//垂直滚动条高度</span></span><br><span class="line">    scrollTop: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">var</span> hasScrollTop = <span class="string">'scrollTop'</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> hasScrollTop ? <span class="keyword">this</span>[<span class="number">0</span>].scrollTop : <span class="keyword">this</span>[<span class="number">0</span>].pageYOffset</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(hasScrollTop ?</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTop = value &#125; :</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTo(<span class="keyword">this</span>.scrollX, value) &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//水平滚动条长度</span></span><br><span class="line">    scrollLeft: <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">var</span> hasScrollLeft = <span class="string">'scrollLeft'</span> <span class="keyword">in</span> <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> hasScrollLeft ? <span class="keyword">this</span>[<span class="number">0</span>].scrollLeft : <span class="keyword">this</span>[<span class="number">0</span>].pageXOffset</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(hasScrollLeft ?</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollLeft = value &#125; :</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">this</span>.scrollTo(value, <span class="keyword">this</span>.scrollY) &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取元素位置</span></span><br><span class="line">    position: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.length) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> elem = <span class="keyword">this</span>[<span class="number">0</span>],</span><br><span class="line">        <span class="comment">// Get *real* offsetParent</span></span><br><span class="line">        offsetParent = <span class="keyword">this</span>.offsetParent(),</span><br><span class="line">        <span class="comment">// Get correct offsets</span></span><br><span class="line">        offset       = <span class="keyword">this</span>.offset(),</span><br><span class="line">        parentOffset = rootNodeRE.test(offsetParent[<span class="number">0</span>].nodeName) ? &#123; <span class="attr">top</span>: <span class="number">0</span>, <span class="attr">left</span>: <span class="number">0</span> &#125; : offsetParent.offset()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Subtract element margins</span></span><br><span class="line">      <span class="comment">// note: when an element has margin: auto the offsetLeft and marginLeft</span></span><br><span class="line">      <span class="comment">// are the same in Safari causing offset.left to incorrectly be 0</span></span><br><span class="line">      offset.top  -= <span class="built_in">parseFloat</span>( $(elem).css(<span class="string">'margin-top'</span>) ) || <span class="number">0</span></span><br><span class="line">      offset.left -= <span class="built_in">parseFloat</span>( $(elem).css(<span class="string">'margin-left'</span>) ) || <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add offsetParent borders</span></span><br><span class="line">      parentOffset.top  += <span class="built_in">parseFloat</span>( $(offsetParent[<span class="number">0</span>]).css(<span class="string">'border-top-width'</span>) ) || <span class="number">0</span></span><br><span class="line">      parentOffset.left += <span class="built_in">parseFloat</span>( $(offsetParent[<span class="number">0</span>]).css(<span class="string">'border-left-width'</span>) ) || <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// Subtract the two offsets</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        top:  offset.top  - parentOffset.top,</span><br><span class="line">        left: offset.left - parentOffset.left</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取元素相对已经定位过的父元素位置</span></span><br><span class="line">    offsetParent: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> parent = <span class="keyword">this</span>.offsetParent || <span class="built_in">document</span>.body</span><br><span class="line">        <span class="keyword">while</span> (parent &amp;&amp; !rootNodeRE.test(parent.nodeName) &amp;&amp; $(parent).css(<span class="string">"position"</span>) == <span class="string">"static"</span>)</span><br><span class="line">          parent = parent.offsetParent</span><br><span class="line">        <span class="keyword">return</span> parent</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for now</span></span><br><span class="line">  $.fn.detach = $.fn.remove</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `width` and `height` functions</span></span><br><span class="line">  <span class="comment">//获取元素的 width, height</span></span><br><span class="line">  ;[<span class="string">'width'</span>, <span class="string">'height'</span>].forEach(<span class="function"><span class="keyword">function</span>(<span class="params">dimension</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dimensionProperty =</span><br><span class="line">      dimension.replace(<span class="regexp">/./</span>, <span class="function"><span class="keyword">function</span>(<span class="params">m</span>)</span>&#123; <span class="keyword">return</span> m[<span class="number">0</span>].toUpperCase() &#125;)</span><br><span class="line"></span><br><span class="line">    $.fn[dimension] = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> offset, el = <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> isWindow(el) ? el[<span class="string">'inner'</span> + dimensionProperty] :</span><br><span class="line">        isDocument(el) ? el.documentElement[<span class="string">'scroll'</span> + dimensionProperty] :</span><br><span class="line">        (offset = <span class="keyword">this</span>.offset()) &amp;&amp; offset[dimension]</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">idx</span>)</span>&#123;</span><br><span class="line">        el = $(<span class="keyword">this</span>)</span><br><span class="line">        el.css(dimension, funcArg(<span class="keyword">this</span>, value, idx, el[dimension]()))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//使用递归加回调访问节点</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">traverseNode</span>(<span class="params">node, fun</span>) </span>&#123;</span><br><span class="line">    fun(node)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = node.childNodes.length; i &lt; len; i++)</span><br><span class="line">      traverseNode(node.childNodes[i], fun)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `after`, `prepend`, `before`, `append`,</span></span><br><span class="line">  <span class="comment">// `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.</span></span><br><span class="line">  adjacencyOperators.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">operator, operatorIndex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inside = operatorIndex % <span class="number">2</span> <span class="comment">//=&gt; prepend, append</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//before 函数</span></span><br><span class="line">    $.fn[operator] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="comment">// arguments can be nodes, arrays of nodes, Zepto objects and HTML strings</span></span><br><span class="line">      <span class="comment">//arguments 参数可以是 DOM 节点,节点数组, Zepto 对象, html 字符串</span></span><br><span class="line">      <span class="keyword">var</span> argType, nodes = $.map(<span class="built_in">arguments</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg</span>) </span>&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> arr = []</span><br><span class="line">            argType = type(arg)</span><br><span class="line">            <span class="comment">//如果是数组</span></span><br><span class="line">            <span class="keyword">if</span> (argType == <span class="string">"array"</span>) &#123;</span><br><span class="line">              arg.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (el.nodeType !== <span class="literal">undefined</span>) <span class="keyword">return</span> arr.push(el)</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ($.zepto.isZ(el)) <span class="keyword">return</span> arr = arr.concat(el.get())</span><br><span class="line">                arr = arr.concat(zepto.fragment(el))</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="keyword">return</span> arr</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> argType == <span class="string">"object"</span> || arg == <span class="literal">null</span> ?</span><br><span class="line">              arg : zepto.fragment(arg)</span><br><span class="line">          &#125;),</span><br><span class="line">          parent, copyByClone = <span class="keyword">this</span>.length &gt; <span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (nodes.length &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params">_, target</span>)</span>&#123;</span><br><span class="line">        parent = inside ? target : target.parentNode</span><br><span class="line"></span><br><span class="line">        <span class="comment">// convert all methods to a "before" operation</span></span><br><span class="line">        target = operatorIndex == <span class="number">0</span> ? target.nextSibling :</span><br><span class="line">                 operatorIndex == <span class="number">1</span> ? target.firstChild :</span><br><span class="line">                 operatorIndex == <span class="number">2</span> ? target :</span><br><span class="line">                 <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> parentInDocument = $.contains(<span class="built_in">document</span>.documentElement, parent)</span><br><span class="line"></span><br><span class="line">        nodes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (copyByClone) node = node.cloneNode(<span class="literal">true</span>)</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (!parent) <span class="keyword">return</span> $(node).remove()</span><br><span class="line"></span><br><span class="line">          parent.insertBefore(node, target)</span><br><span class="line">          <span class="keyword">if</span> (parentInDocument) traverseNode(node, <span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (el.nodeName != <span class="literal">null</span> &amp;&amp; el.nodeName.toUpperCase() === <span class="string">'SCRIPT'</span> &amp;&amp;</span><br><span class="line">               (!el.type || el.type === <span class="string">'text/javascript'</span>) &amp;&amp; !el.src)&#123;</span><br><span class="line">              <span class="keyword">var</span> target = el.ownerDocument ? el.ownerDocument.defaultView : <span class="built_in">window</span></span><br><span class="line">              target[<span class="string">'eval'</span>].call(target, el.innerHTML)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// after    =&gt; insertAfter</span></span><br><span class="line">    <span class="comment">// prepend  =&gt; prependTo</span></span><br><span class="line">    <span class="comment">// before   =&gt; insertBefore</span></span><br><span class="line">    <span class="comment">// append   =&gt; appendTo</span></span><br><span class="line">    $.fn[inside ? operator+<span class="string">'To'</span> : <span class="string">'insert'</span>+(operatorIndex ? <span class="string">'Before'</span> : <span class="string">'After'</span>)] = <span class="function"><span class="keyword">function</span>(<span class="params">html</span>)</span>&#123;</span><br><span class="line">      $(html)[operator](<span class="keyword">this</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  zepto.Z.prototype = Z.prototype = $.fn</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Export internal API functions in the `$.zepto` namespace</span></span><br><span class="line">  zepto.uniq = uniq</span><br><span class="line">  zepto.deserializeValue = deserializeValue</span><br><span class="line">  $.zepto = zepto</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// If `$` is not yet defined, point it to `Zepto`</span></span><br><span class="line"><span class="built_in">window</span>.Zepto = Zepto</span><br><span class="line"><span class="comment">// console.log(typeof Zepto);</span></span><br><span class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto)</span><br><span class="line"><span class="comment">// console.log($);</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Shawn
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://zhangxiang958.github.io/2017/02/16/Zepto 源码全剖析/" title="Zepto 源码全剖析">http://zhangxiang958.github.io/2017/02/16/Zepto 源码全剖析/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/16/Zepto 源码简单剖析/" rel="next" title="Zepto 源码简单剖析">
                <i class="fa fa-chevron-left"></i> Zepto 源码简单剖析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/20/Event In Zepto/" rel="prev" title="Event In Zepto">
                Event In Zepto <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMjExMy84Njc3"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://img.ijarvis.cn/916161494.jpg" alt="Shawn">
            
              <p class="site-author-name" itemprop="name">Shawn</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">71</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/zhangxiang958" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:shawncheung702@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shawn</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
